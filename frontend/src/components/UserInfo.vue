<template>
  <div class="intro">
    <h2>Dialectr</h2>
    <h3>ä¸ºä»€ä¹ˆè¦è°ƒæŸ¥æ–¹è¨€</h3>
    <p>è‡ª 20 ä¸–çºªä»¥æ¥ï¼Œæ–¹è¨€ä¸€ç›´æ˜¯è¯­è¨€å­¦å®¶çš„ç ”ç©¶è¯¾é¢˜ï¼Œä¹Ÿæ˜¯æ°‘ä¼—é¥¶æœ‰å…´è¶£çš„èŠå¤©è¯é¢˜ã€‚é€šè¿‡æ–¹è¨€è°ƒæŸ¥ï¼Œå¯ä»¥äº†è§£ä¸€ä¸ªè¯­è¨€ç¤¾åŒºçš„è¯­éŸ³å·®å¼‚å’Œç›¸ä¼¼æ€§ï¼Œå®šé‡è®¡ç®—<a
        href="https://en.wikipedia.org/wiki/Linguistic_distance" target="_blank" rel="noopener noreferrer"
        title="linguistic distance">è¯­è¨€è·ç¦»</a>ï¼Œç†è§£æˆ–æ”¶é›†è¯­è¨€å½¢å¼çš„ç»†èŠ‚ï¼Œè¿™ä¹Ÿæ˜¯<a href="https://en.wikipedia.org/wiki/Dialectology"
        target="_blank" rel="noopener noreferrer" title="dialectology">æ–¹è¨€å­¦</a>æ‰€å…³æ³¨çš„å†…å®¹ã€‚</p>
    <h3>å¦‚ä½•è°ƒæŸ¥</h3>
    <p>æˆ‘ä»¬é‡‡ç”¨åœ¨äº’è”ç½‘å‘å¸ƒäº’åŠ¨é—®å·çš„æ–¹å¼æ”¶é›†æ–¹è¨€èµ„æ–™ï¼Œå°¤å…¶æ˜¯è¯­éŸ³æ•°æ®ã€‚é€šè¿‡æˆ‘ä»¬çš„é¡µé¢ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿‘ä¼¼æ¸¸æˆçš„å½¢å¼ï¼Œåœ¨çœ‹å›¾è¯´è¯çš„äº’åŠ¨ä¸­å®Œæˆè°ƒæŸ¥é—®å·ã€‚</p>
    <p>è®¿é—®æˆ‘ä»¬çš„é¡µé¢æ—¶ï¼Œéœ€è¦æµè§ˆå™¨æˆæƒä½¿ç”¨æ‚¨çš„è®¾å¤‡å½•éŸ³æƒé™ï¼Œè¿™é€šå¸¸å¯ä»¥é€šè¿‡å‡ æ¬¡è½»æ¾çš„ç‚¹å‡»å®Œæˆã€‚æ‚¨å¯ä»¥åœ¨ä¸‹é¢çš„å½•éŸ³æµ‹è¯•ä¸­è°ƒè¯•éº¦å…‹é£ã€‚</p>
    <p>ç‚¹å‡»<span class="button">å½•éŸ³</span>æŒ‰é’®å¯ä»¥å½•åˆ¶å£°éŸ³ï¼Œå½•éŸ³å®Œæˆåç‚¹å‡»<span class="button">ç»“æŸå½•éŸ³</span>æŒ‰é’®å®Œæˆä¸€æ¬¡å½•éŸ³ã€‚å¦‚æœå¯¹å½•éŸ³ä¸æ»¡æ„ï¼Œæ‚¨å¯ä»¥ç‚¹å‡»<span
        class="button">é‡æ–°å½•åˆ¶</span>æŒ‰é’®ã€‚å½•åˆ¶çš„å£°éŸ³å¯ä»¥å›æ”¾è¯•å¬ã€‚</p>
    <p>æ¯ä¸€ä¸ªé¡µé¢é€šå¸¸åªéœ€è°ƒæŸ¥ä¸€é¡¹å†…å®¹ã€‚å½“å®Œæˆå½•éŸ³ä¹‹åï¼Œå°±å¯ä»¥ç‚¹å‡»<span class="button">ä¸‹ä¸€ä¸ª</span>æŒ‰é’®æ¥æ¨è¿›è°ƒæŸ¥è¿›åº¦ã€‚æœ¬æ¬¡è°ƒæŸ¥å¤§çº¦å ç”¨æ‚¨5åˆ†é’Ÿæ—¶é—´ã€‚</p>
    <h3>å½•éŸ³æµ‹è¯•</h3>
    <p>å½•éŸ³æ—¶ï¼Œè¯·å°½é‡ä¿æŒç¯å¢ƒå®‰é™ï¼Œä»¥å…å½±å“å½•åˆ¶æ•ˆæœã€‚</p>
    <div class="recorder-container">
      <button id="btn-record" class="btn" :class="{ 'btn-primary': !isRecording, 'btn-danger': isRecording }"
        @click="startRecording" v-if="!isCompleted">
        {{ isRecording ? 'ç»“æŸå½•éŸ³' : recorded ? 'é‡æ–°å½•åˆ¶' : 'å½•éŸ³' }}
      </button>
      <span style="display:inline-block;width: 3em" v-if="recorded"></span>
      <button id="btn-replay" class="btn btn-primary" @click="playRecording" v-if="recorded">æ’­æ”¾å½•éŸ³</button>
      <audio ref="audioPlayer"></audio>
    </div>
    <h3>æˆ‘ä»¬æ˜¯è°</h3>
    <p>æˆ‘ä»¬æ˜¯æ¥è‡ªé«˜æ ¡çš„æ–¹è¨€å­¦ç§‘ç ”å›¢é˜Ÿï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¹¡åœŸæ–‡åŒ–çš„çˆ±å¥½è€…å’Œå®è·µè€…ã€‚æ¬¢è¿æ¥è‡ªç¤¾ä¼šå„ç•Œçš„æŒ‡å¯¼å’Œå»ºè®®ï¼</p>
    <button id="btn-submit" class="btn btn-primary" @click="next">æˆ‘å·²é˜…è¯»ï¼Œå¼€å§‹å½•éŸ³</button>
  </div>
</template>
<style scoped>
.intro {
  max-width: 100%;
  padding: 16px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.intro h2 {
  width: 90%;
  font-size: 56px;
  font-weight: 600;
  color: transparent;
  background-image: linear-gradient(to right, #553c9a, #ee4b2b, #00c2cb, #ff7f50, #553c9a);
  -webkit-background-clip: text;
  background-clip: text;
  background-size: 140%;
  background-position: -140%;
  transition: all ease-in-out 2s;
  cursor: pointer;
  text-align: center;
  margin: 0 auto;
}

.intro h2:hover {
  background-position: 140%;
}

.intro h3 {
  text-align: center;
  margin: 1rem auto;
}

.intro h3::before {
  content: 'ğŸ¤ ';
}

.intro h3::after {
  content: ' ğŸ¤';
}

.intro p {
  text-align: start;
  text-indent: 2em;
  margin: 0.3rem auto;
  line-height: 1.8em;
  max-width: 90%;
  font: 1.2em sans-serif;
}

.intro span.button {
  background-color: #4285f4;
  border: 1px solid #3bafda;
  border-radius: 8px;
  padding: 2px 4px;
  margin-left: 0.2em;
  margin-right: 0.2em;
  color: #eee;
  white-space: nowrap;
  font: 0.7em sans-serif;
}

.intro a {
  text-decoration: none;
  color: #4285f4;
}

*[title] {
  text-decoration: none;
  color: #3bafda;
  font-weight: bold;
}


.btn.btn-danger {
  background-color: red !important;
  border-color: red !important;
}

div.recorder-container {
  width: 100%;
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
}

div.btn-container {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
}

button {
  display: block;
  width: 100%;
  max-width: 16rem;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
  font-size: 16px;
  padding: 12px;
  border-radius: 4px;
  border: none;
  background-color: #007bff;
  color: #fff;
}

#btn-record {
  width: 100%;
}

#btn-submit {
  width: 100%;
  margin-top: 16px;
}
</style>


<script>
import 'bootstrap/dist/css/bootstrap.min.css';
import { MediaRecorder, register } from 'extendable-media-recorder';
import { connect } from 'extendable-media-recorder-wav-encoder';

export default {
  data() {
    return {
      recorded: false,
      isRecording: false,
      isCompleted: false
    };
  },

  beforeMount() {
    this.reau();
  },

  methods: {
    async reau() {
      await register(await connect());
    },

    startRecording() {
      console.log('start recording')
      if (!this.isRecording) {
        this.isRecording = true;
        this.recordedChunks = [];
        const mediaConstraints = {
          audio: true
        };
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
          navigator.mediaDevices.getUserMedia(mediaConstraints)
            .then((stream) => {
              this.mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/wav' });
              this.mediaRecorder.start();

              this.mediaRecorder.addEventListener('dataavailable', (event) => {
                if (event.data.size > 0) {
                  this.recordedChunks.push(event.data);
                }
              });

              this.mediaRecorder.addEventListener('stop', () => {
                this.audioBlob = new Blob(this.recordedChunks, { type: 'audio/wav' });
                // Now you can upload or update the recorded audio.
                this.recorded = true;
              });
            })
            .catch((error) => {
              console.error('Error starting recording:', error);
              alert('æ— æ³•è®¿é—®éº¦å…‹é£ï¼Œè¯·æ£€æŸ¥æ‚¨çš„è®¾å¤‡æƒé™è®¾ç½®ã€‚');
              this.isRecording = false;
            });
        } else {
          alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒå½•éŸ³åŠŸèƒ½ï¼Œè¯·å°è¯•ä½¿ç”¨å…¶ä»–æµè§ˆå™¨ã€‚');
          this.isRecording = false;
        }
      } else {
        if (this.mediaRecorder) {
          this.isRecording = false;
          this.mediaRecorder.stop();
        } else {
          console.error('MediaRecorder is not available.');
        }
      }
    },

    playRecording() {
      if (this.recorded) {
        this.audioUrl = URL.createObjectURL(this.audioBlob);
        const audioPlayer = this.$refs.audioPlayer;
        audioPlayer.src = this.audioUrl;
        audioPlayer.play();
      }
    },
    async next() {
      this.$store.commit('setAccessToken', '');
      this.$store.commit('setWordId', 1);
      this.$router.replace('/user-registration');
    },
  },
}

</script>